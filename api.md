# MinerU API ç®€åŒ–æ¥å£æ–‡æ¡£

## æ¦‚è¿°

MinerU API å·²ç®€åŒ–ï¼Œç°åœ¨åªä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼Œæä¾›æ›´ç®€æ´æ¸…æ™°çš„æ¥å£ã€‚

## å¯ç”¨å‘½ä»¤

### 1. å¥åº·æ£€æŸ¥ (health)

æ£€æŸ¥æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€å’Œä»»åŠ¡ç»Ÿè®¡ã€‚

```bash
python3 api_server/api_manager.py health
```

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "status": "healthy",
  "workers": 1,
  "pending_tasks": 0,
  "processing_tasks": 0,
  "completed_tasks": 6
}
```

### 2. ä»»åŠ¡åˆ—è¡¨ (list)

åˆ—å‡ºä»»åŠ¡å¹¶æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯å’Œè¿›åº¦ã€‚æ”¯æŒæŒ‰chunk_idè¿‡æ»¤ã€‚

**æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡ï¼š**
```bash
python3 api_server/api_manager.py list
```

**æŒ‰chunk_idè¿‡æ»¤ï¼š**
```bash
python3 api_server/api_manager.py list --chunk-id 0001
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
æŸ¥è¯¢ chunk_id: 0001
================================================================================

ğŸ“Š ä»»åŠ¡ç»Ÿè®¡ (å…± 6 ä¸ª)
  æ€»æ•°:     6
  ç­‰å¾…:     0
  å¤„ç†ä¸­:   0
  å·²å®Œæˆ:   6
  å¤±è´¥:     0

ğŸ“ˆ å¤„ç†è¿›åº¦: 100.0%
  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]

====================================================================================================
ä»»åŠ¡ID                                     æ–‡ä»¶å                            Chunk ID             çŠ¶æ€
----------------------------------------------------------------------------------------------------
fa286a31-eefa-4171-9809-728cea32cf0c     0062.pdf                       0001                 âœ… completed
e53b1704-0d38-4e67-a79d-9a92b1823446     test.pdf                       æ— åˆ†ç»„                âœ… completed
```

### 3. æ‰¹é‡æäº¤ç›®å½• (batch-dir)

æ‰¹é‡æäº¤ç›®å½•ä¸­çš„æ‰€æœ‰PDFæ–‡ä»¶ï¼ˆå¼‚æ­¥ï¼Œåªä¸Šä¼ ä¸ç­‰å¾…ï¼‰ã€‚

```bash
python3 api_server/api_manager.py batch-dir /path/to/pdf/directory/ --chunk-id 0001
```

å·¥ä½œæµç¨‹ï¼š
1. å®¢æˆ·ç«¯æ‰«ææœ¬åœ°ç›®å½•ä¸­çš„PDFæ–‡ä»¶
2. é€ä¸ªé€šè¿‡HTTPä¸Šä¼ åˆ°æœåŠ¡å™¨
3. ç«‹å³è¿”å›ä»»åŠ¡IDï¼Œä¸ç­‰å¾…å¤„ç†å®Œæˆ

å‚æ•°ï¼š
- `input_dir`: åŒ…å«PDFæ–‡ä»¶çš„ç›®å½•è·¯å¾„
- `--chunk-id`: æ‰¹æ¬¡åˆ†ç»„IDï¼ˆå¯é€‰ï¼‰

### 4. åŒæ­¥æ‰¹é‡å¤„ç† (batch-process)

æ‰¹é‡å¤„ç†ç›®å½•ä¸­çš„æ‰€æœ‰PDFæ–‡ä»¶ï¼ˆåŒæ­¥ï¼Œæäº¤å¹¶ç­‰å¾…å®Œæˆï¼Œè‡ªåŠ¨ä¸‹è½½ç»“æœï¼‰ã€‚

**âš ï¸ å¿…éœ€å‚æ•°ï¼šå¿…é¡»æŒ‡å®šinput_dirå’Œoutput_dir**

```bash
python3 api_server/api_manager.py batch-process /path/to/pdf/directory/ /path/to/output/ --chunk-id 0001
```

å·¥ä½œæµç¨‹ï¼š
1. å®¢æˆ·ç«¯æ‰«ææœ¬åœ°ç›®å½•ä¸­çš„PDFæ–‡ä»¶
2. é€ä¸ªé€šè¿‡HTTPä¸Šä¼ åˆ°æœåŠ¡å™¨
3. ç›‘æ§ä»»åŠ¡çŠ¶æ€ï¼ˆè½®è¯¢ï¼‰
4. ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
5. è‡ªåŠ¨ä¸‹è½½ç»“æœåˆ°æŒ‡å®šç›®å½•

å‚æ•°ï¼š
- `input_dir`: è¾“å…¥ç›®å½•è·¯å¾„ï¼ˆåŒ…å«PDFæ–‡ä»¶ï¼‰
- `output_dir`: è¾“å‡ºç›®å½•è·¯å¾„ï¼ˆå¿…é¡»æŒ‡å®šï¼Œå­˜æ”¾ä¸‹è½½çš„ç»“æœï¼‰
- `--chunk-id`: æ‰¹æ¬¡åˆ†ç»„IDï¼ˆå¯é€‰ï¼‰
- `--interval`: æ£€æŸ¥é—´éš”(ç§’)ï¼Œé»˜è®¤5ç§’
- `--timeout`: è¶…æ—¶æ—¶é—´(ç§’)ï¼Œé»˜è®¤1800ç§’ï¼ˆ30åˆ†é’Ÿï¼‰

è¾“å‡ºç¤ºä¾‹ï¼š
```
åŒæ­¥æ‰¹é‡å¤„ç†ç›®å½•: /workspace/extracted_files/
è¾“å‡ºç›®å½•: /tmp/output
Chunk ID: 0003
æ£€æŸ¥é—´éš”: 3ç§’
è¶…æ—¶æ—¶é—´: 30ç§’
================================================================================

ğŸ“ æ‰¾åˆ° 3 ä¸ªPDFæ–‡ä»¶

ğŸš€ å¼€å§‹ä¸Šä¼ æ–‡ä»¶...
--------------------------------------------------------------------------------
[1/3] ä¸Šä¼ : 0062.pdf
  âœ“ ä»»åŠ¡ID: 6adea341-25da-41ad-88f4-044305399571
[2/3] ä¸Šä¼ : 0066.pdf
  âœ“ ä»»åŠ¡ID: d56adcc4-67d5-4323-92be-625628d5cdaa
[3/3] ä¸Šä¼ : 0016.pdf
  âœ“ ä»»åŠ¡ID: a4494614-ad79-40a6-bb3f-03980c9c3bb1
--------------------------------------------------------------------------------

âœ… ä¸Šä¼ å®Œæˆ! å…± 3 ä¸ªä»»åŠ¡

â³ å¼€å§‹ç›‘æ§ä»»åŠ¡è¿›åº¦...
================================================================================

[00:00] æ£€æŸ¥ä»»åŠ¡çŠ¶æ€...
  å¾…å¤„ç†: 3, å·²å®Œæˆ: 0, å¤±è´¥: 0
  âŸ³ 6adea341... - processing
  âŸ³ d56adcc4... - processing
  âŸ³ a4494614... - processing

â³ ç­‰å¾… 3 ç§’åç»§ç»­æ£€æŸ¥...

[00:06] æ£€æŸ¥ä»»åŠ¡çŠ¶æ€...
  å¾…å¤„ç†: 0, å·²å®Œæˆ: 3, å¤±è´¥: 0
  âœ… 6adea341... - å·²å®Œæˆ
  âœ… d56adcc4... - å·²å®Œæˆ
  âœ… a4494614... - å·²å®Œæˆ

================================================================================
ğŸ‰ ä»»åŠ¡å¤„ç†å®Œæˆ!
  æ€»ä»»åŠ¡æ•°: 3
  âœ… å·²å®Œæˆ: 3
  âŒ å¤±è´¥: 0
  â±ï¸  æ€»è€—æ—¶: 00:06
================================================================================

ğŸ’¾ å¼€å§‹ä¸‹è½½ç»“æœåˆ°: /tmp/output
--------------------------------------------------------------------------------
ä¸‹è½½ 6adea341-25da-41ad-88f4-044305399571 åˆ° /tmp/output/result_6adea341-25da-41ad-88f4-044305399571.zip
  âœ“ æˆåŠŸ (2702012 bytes)
ä¸‹è½½ d56adcc4-67d5-4323-92be-625628d5cdaa åˆ° /tmp/output/result_d56adcc4-67d5-4323-92be-625628d5cdaa.zip
  âœ“ æˆåŠŸ (1021254 bytes)
ä¸‹è½½ a4494614-ad79-40a6-bb3f-03980c9c3bb1 åˆ° /tmp/output/result_a4494614-ad79-40a6-bb3f-03980c9c3bb1.zip
  âœ“ æˆåŠŸ (2910865 bytes)
--------------------------------------------------------------------------------
ğŸ“¦ ä¸‹è½½å®Œæˆ!
  æˆåŠŸä¸‹è½½: 3/3
```

### 5. ä¸‹è½½ä»»åŠ¡ç»“æœ (task-download)

ä¸‹è½½æŒ‡å®šä»»åŠ¡çš„ç»“æœã€‚

**âš ï¸ å¿…éœ€å‚æ•°ï¼šå¿…é¡»æŒ‡å®štask_idså’Œoutput_dir**

```bash
python3 api_server/api_manager.py task-download <task-id-1> <task-id-2> /path/to/output/
```

å‚æ•°ï¼š
- `task_ids`: è¦ä¸‹è½½çš„ä»»åŠ¡IDåˆ—è¡¨ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰
- `output_dir`: è¾“å‡ºç›®å½•è·¯å¾„ï¼ˆå¿…é¡»æŒ‡å®šï¼‰

### 6. ä¸‹è½½Chunkç»“æœ (chunk-download)

ä¸‹è½½æ•´ä¸ªchunkçš„æ‰€æœ‰ç»“æœåˆ°æŒ‡å®šç›®å½•ã€‚

**âš ï¸ å¿…éœ€å‚æ•°ï¼šå¿…é¡»æŒ‡å®šchunk_idå’Œoutput_dir**

```bash
python3 api_server/api_manager.py chunk-download 0001 /path/to/output/
```

å‚æ•°ï¼š
- `chunk_id`: è¦ä¸‹è½½çš„chunk ID
- `output_dir`: è¾“å‡ºç›®å½•è·¯å¾„ï¼ˆå¿…é¡»æŒ‡å®šï¼‰

## Makefile é›†æˆ

ä½¿ç”¨Makefileå¿«é€Ÿæ‰§è¡Œå¸¸ç”¨å‘½ä»¤ï¼š

```bash
# å¥åº·æ£€æŸ¥
make health

# æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨
make list

# å¼‚æ­¥æ‰¹é‡æäº¤ç›®å½•ä¸­çš„PDF
make batch-tasks

# åŒæ­¥æ‰¹é‡å¤„ç†å¹¶ä¸‹è½½ç»“æœ
make batch-process INPUT_DIR=/path/to/pdf/directory/ OUTPUT_DIR=/path/to/output/

# ä¸‹è½½æŒ‡å®šä»»åŠ¡ç»“æœ (å¿…é¡»æä¾›TASK_IDSå’ŒOUTPUT_DIR)
make task-download TASK_IDS="id1 id2 id3" OUTPUT_DIR=/path/to/output/

# ä¸‹è½½chunkç»“æœ (å¿…é¡»æä¾›CHUNK_IDå’ŒOUTPUT_DIR)
make chunk-download CHUNK_ID=0001 OUTPUT_DIR=/path/to/output/
```

## APIæœåŠ¡ç«¯ç‚¹

å®¢æˆ·ç«¯é€šè¿‡ä»¥ä¸‹HTTPç«¯ç‚¹ä¸æœåŠ¡å™¨é€šä¿¡ï¼š

### ä»»åŠ¡æäº¤
- **POST** `/submit_task` - æäº¤å•ä¸ªPDFæ–‡ä»¶
- **POST** `/batch_submit` - æ‰¹é‡æäº¤ï¼ˆç›®å½•æ–¹å¼ï¼Œå·²ä¿®æ”¹ä¸ºå®¢æˆ·ç«¯ä¸Šä¼ ï¼‰

### ä»»åŠ¡ç®¡ç†
- **GET** `/get_status/{task_id}` - è·å–ä»»åŠ¡çŠ¶æ€
- **GET** `/list_tasks` - åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
- **GET** `/list_tasks_by_chunk/{chunk_id}` - æŒ‰chunk_idåˆ—å‡ºä»»åŠ¡

### ä¸‹è½½ç»“æœ
- **GET** `/download_result/{task_id}` - ä¸‹è½½å•ä¸ªä»»åŠ¡ç»“æœ
- **GET** `/download_chunk_results/{chunk_id}` - ä¸‹è½½æ‰€æœ‰chunkç»“æœä¸ºzip

### ç³»ç»ŸçŠ¶æ€
- **GET** `/health` - å¥åº·æ£€æŸ¥

## å˜æ›´å†å²

### ç®€åŒ–å‰ (v1.0)
- 13ä¸ªå‘½ä»¤
- å¤æ‚çš„æŠ¥å‘Šç”Ÿæˆ
- HTMLå¯è§†åŒ–æŠ¥å‘Š
- ä»»åŠ¡ç›‘æ§
- è¿›åº¦æŸ¥çœ‹
- æ¸…ç†åŠŸèƒ½

### ç®€åŒ–å (v2.0)
- **5ä¸ªæ ¸å¿ƒå‘½ä»¤**
- ç®€åŒ–çš„åˆ—è¡¨æ˜¾ç¤ºï¼ˆåŒ…å«ç»Ÿè®¡å’Œè¿›åº¦ï¼‰
- å®¢æˆ·ç«¯ä¸Šä¼ æ¨¡å¼ï¼ˆbatch-dirï¼‰
- ä¿ç•™åŸºæœ¬ä¸‹è½½åŠŸèƒ½
- æ–°å¢chunkä¸‹è½½åˆ°ç›®å½•åŠŸèƒ½

### å¼ºåŒ–è¦æ±‚ (v2.1)
- ä¸‹è½½å‘½ä»¤æ”¹ä¸ºå¿…é¡»æŒ‡å®šå‚æ•°
- `download` â†’ `task-download`ï¼Œè¦æ±‚task_idså’Œoutput_dir
- `chunk-download` è¦æ±‚chunk_idå’Œoutput_dir

### åŒæ­¥å¤„ç† (v2.2)
- æ–°å¢ `batch-process` å‘½ä»¤
- åŒæ­¥æ‰¹é‡å¤„ç†ï¼šæäº¤â†’ç›‘æ§â†’ç­‰å¾…â†’ä¸‹è½½
- è‡ªåŠ¨ä¸‹è½½ç»“æœåˆ°æŒ‡å®šç›®å½•
- å®æ—¶è¿›åº¦æ˜¾ç¤ºå’ŒçŠ¶æ€ç›‘æ§

## ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´å·¥ä½œæµ

```bash
# 1. æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
make health

# 2. å‡†å¤‡PDFæ–‡ä»¶
mkdir -p /workspace/extracted_files/
cp /path/to/your/*.pdf /workspace/extracted_files/

# 3a. å¼‚æ­¥æ‰¹é‡æäº¤ï¼ˆå¿«é€Ÿæäº¤ï¼Œä¸ç­‰å¾…ï¼‰
make batch-tasks

# 3b. åŒæ­¥æ‰¹é‡å¤„ç†ï¼ˆæäº¤å¹¶ç­‰å¾…å®Œæˆï¼Œè‡ªåŠ¨ä¸‹è½½ï¼‰
make batch-process INPUT_DIR=/workspace/extracted_files/ OUTPUT_DIR=/tmp/output/

# 4. æŸ¥çœ‹è¿›åº¦
make list --chunk-id 0001

# 5. ç­‰å¾…å¤„ç†å®Œæˆï¼ˆä½¿ç”¨listå‘½ä»¤ç›‘æ§ï¼‰
# 6. ä¸‹è½½æŒ‡å®šä»»åŠ¡ç»“æœ
make task-download TASK_IDS="id1 id2" OUTPUT_DIR=/tmp/download/

# æˆ–è€…ä¸‹è½½æ•´ä¸ªchunkç»“æœ
make chunk-download CHUNK_ID=0001 OUTPUT_DIR=/tmp/chunk_download/
```

## å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤ | åŠŸèƒ½ | æè¿° |
|------|------|------|
| health | å¥åº·æ£€æŸ¥ | æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€å’Œä»»åŠ¡ç»Ÿè®¡ |
| list | åˆ—å‡ºä»»åŠ¡ | æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨ï¼Œæ”¯æŒchunk_idè¿‡æ»¤ |
| batch-dir | å¼‚æ­¥æ‰¹é‡æäº¤ | æ‰¹é‡æäº¤ç›®å½•ä¸­çš„PDFæ–‡ä»¶ï¼ˆåªä¸Šä¼ ï¼‰ |
| batch-process | åŒæ­¥æ‰¹é‡å¤„ç† | æ‰¹é‡å¤„ç†å¹¶ç­‰å¾…å®Œæˆï¼Œè‡ªåŠ¨ä¸‹è½½ç»“æœ |
| task-download | ä¸‹è½½ä»»åŠ¡ç»“æœ | ä¸‹è½½æŒ‡å®šä»»åŠ¡ç»“æœï¼ˆéœ€å‚æ•°ï¼‰ |
| chunk-download | ä¸‹è½½chunkç»“æœ | ä¸‹è½½æ•´ä¸ªchunkç»“æœåˆ°ç›®å½•ï¼ˆéœ€å‚æ•°ï¼‰ |

## æ³¨æ„äº‹é¡¹

1. **æœåŠ¡å™¨é‡å¯**ï¼šé‡å¯æœåŠ¡å™¨ä¼šæ¸…é™¤æ‰€æœ‰ä»»åŠ¡è®°å½•
2. **Chunk ID**ï¼šç”¨äºä»»åŠ¡åˆ†ç»„ï¼Œä¾¿äºç®¡ç†å’Œæ‰¹é‡ä¸‹è½½
3. **æ–‡ä»¶æ ¼å¼**ï¼šä»…æ”¯æŒPDFæ–‡ä»¶
4. **å¼‚æ­¥ vs åŒæ­¥**ï¼š
   - `batch-dir`: å¼‚æ­¥ï¼Œåªä¸Šä¼ æ–‡ä»¶ï¼Œç«‹å³è¿”å›
   - `batch-process`: åŒæ­¥ï¼Œä¸Šä¼ â†’ç›‘æ§â†’ç­‰å¾…â†’ä¸‹è½½ï¼Œä¸€æ°”å‘µæˆ
5. **ä¸‹è½½è¦æ±‚**ï¼š
   - `task-download`: å¿…é¡»æŒ‡å®štask_idså’Œoutput_dir
   - `chunk-download`: å¿…é¡»æŒ‡å®šchunk_idå’Œoutput_dir
   - `batch-process`: å¿…é¡»æŒ‡å®šinput_dirå’Œoutput_dir
6. **çŠ¶æ€è¯´æ˜**ï¼š
   - â³ pendingï¼šç­‰å¾…å¤„ç†
   - âŸ³ processingï¼šæ­£åœ¨å¤„ç†
   - âœ… completedï¼šå·²å®Œæˆ
   - âŒ failedï¼šå¤„ç†å¤±è´¥

## å¸¸è§é—®é¢˜

**Q: batch-dir å’Œ batch-process æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
A: `batch-dir` æ˜¯å¼‚æ­¥çš„ï¼Œåªä¸Šä¼ æ–‡ä»¶å°±è¿”å›ï¼›`batch-process` æ˜¯åŒæ­¥çš„ï¼Œä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆå¹¶ä¸‹è½½ç»“æœã€‚

**Q: å¦‚ä½•æŸ¥çœ‹ç‰¹å®šchunkçš„ä»»åŠ¡ï¼Ÿ**
A: ä½¿ç”¨ `list --chunk-id <chunk_id>`

**Q: å¦‚ä½•ä¸‹è½½æ•´ä¸ªchunkçš„ç»“æœï¼Ÿ**
A: ä½¿ç”¨ `chunk-download <chunk_id> <output_dir>`

**Q: å¦‚ä½•ä¸‹è½½æŒ‡å®šä»»åŠ¡çš„ç»“æœï¼Ÿ**
A: ä½¿ç”¨ `task-download <task_id1> <task_id2> <output_dir>`

**Q: batch-process æ”¯æŒè‡ªå®šä¹‰è¶…æ—¶å—ï¼Ÿ**
A: æ˜¯çš„ï¼Œä½¿ç”¨ `--timeout` å‚æ•°ï¼Œå•ä½ç§’ã€‚é»˜è®¤1800ç§’ï¼ˆ30åˆ†é’Ÿï¼‰ã€‚

**Q: æœåŠ¡å™¨é‡å¯åä»»åŠ¡ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ**
A: æœåŠ¡å™¨é‡å¯ä¼šæ¸…é™¤æ‰€æœ‰ä»»åŠ¡ï¼Œéœ€è¦é‡æ–°æäº¤ã€‚å»ºè®®åœ¨é‡å¯å‰ä¸‹è½½æ‰€æœ‰ç»“æœã€‚

**Q: æ”¯æŒå“ªäº›æ–‡ä»¶æ ¼å¼ï¼Ÿ**
A: ç›®å‰ä»…æ”¯æŒPDFæ–‡ä»¶æ ¼å¼ã€‚
